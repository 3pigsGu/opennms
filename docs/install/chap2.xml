<?xml version="1.0" encoding="utf-8"?>
<chapter id="chap2" label="2">
	<title>Chapter 2</title>
	<subtitle>Configuring Dependencies</subtitle>
	<para>
		If you are planning to use the web installer to install the RPMs for
		OpenNMS and it's dependencies, you can skip to Chapter 3.  If you have any of the 
		dependencies already installed, you will need to make sure to read this chapter.  
		Most newer kernels will meet the requirements, and the installer script should 
		take care of upgrading everything else that you will need to run OpenNMS on your 
		system.
	</para>
	<sect1 id="chap2sect1" label="2.1">
		<title>Linux Kernel 2.2 or Lower</title>
		<para>
			Due to the large number of JAVA threads used in OpenNMS, you may need to
			recompile the linux kernel to handle more tasks.  In the header file
			include/linux/tasks.h in the source directory set NR_Tasks to 4000.  Most
			kernels provided with commercial distributions will not need to be modified
			and can already handle this many tasks.  The following reflects the change
			that should be made to the task.h header before recompiling.
			<programlisting>
	#define NR_TASKS        4000
			</programlisting>
			More information about compiling a new kernel can be found in the 
			<ulink url="http://www.linuxdoc.org/HOWTO/Kernel-HOWTO.html">Kernel-HOWTO</ulink>
		</para>
	</sect1>
	<sect1 id="chap2sect2" label="2.2">
		<title>PostgreSQL Configuration</title>
		<para>
			PostgreSQL must be run with the TCP/IP listener running in order for OpenNMS to
			make connections to the database (Java has no support for UNIX domain sockets).
			As of PostgreSQL 7.1 (which is now required), There is a simple configuration file
			to configure this, and a number of other performance options that are suggested.
		</para>
		<para>
			First, start up PostgreSQL to make sure that the database has been initialized:
			<programlisting>
  /etc/init.d/postgresql start
			</programlisting>
			Then, edit the /var/lib/pgsql/data/postgresql.conf and add the following lines:
			<programlisting>
  tcpip_socket = true
  max_connections = 256
  shared_buffers = 1024
			</programlisting>
			Note that the <emphasis>max_connections</emphasis> and <emphasis>shared_buffers</emphasis>
			are not required but recommended.  Due to the heavily threaded nature of OpenNMS,
			it is very easy to overstep the default of 32 incoming connections for PostgreSQL.
			If this occurs, many parts of OpenNMS may stop working correctly.
		</para>
		<para>
			After making these changes, the next time you start PostgreSQL, the new settings
			will take affect.
		</para>
		<para>
			Please note that if you are building OpenNMS and/or PostgreSQL from source, you need
			to run "<emphasis>make install-all-headers</emphasis>" as well as the normal
			"make install" or you will be unable to compile the postgresql extensions for
			OpenNMS.
		</para>
	</sect1>
	<sect1 id="chap2sect3" label="2.3">
		<title>TomCat</title>
		<para>
			The OpenNMS install.pl script expects that tomcat is installed in /var/tomcat4.  If
			this is not the location of your Tomcat 4 directory, you will have to edit the
			<emphasis>$serverxml</emphasis> line near the top of
			<emphasis>$OPENNMS_HOME/bin/install.pl</emphasis>.
		</para>
	</sect1>
	<sect1 id="chap2sect4" label="2.4">
		<title>RRDTool</title>
		<para>
			If you plan on building OpenNMS from source, you need to make sure you install
			RRDTool with the shared libraries.  There is information about this in the 
			README file in the source directory of rrdtool.  The process basically consists
			of the following
			<programlisting>
	sh configure --enable-shared
	make
	make install
			</programlisting>
		</para>
	</sect1>
	<sect1 id="chap2sect5" label="2.5">
		<title>CPAN</title>
		<para>
			The CPAN libraries DBI and DBD:Pg need to be installed in order to do a source 
			build.  The following commands should install these packages
			<programlisting>
	perl -MCPAN -e shell
	install DBI
	install DBD::Pg
			</programlisting>
		</para>
	</sect1>
	<sect1 id="chap2sect6" label="2.6">
		<title>JAVA</title>
		<para>
			The JDK package is currently necessary even for runtime because of tomcat's
			dependence on the compilation runtime for parsing JSP pages.  The
			environment variable JAVA_HOME should be set to /usr/java/j2sdk1.4.0 or the
			directory where it was installed for OpenNMS to run properly.
		</para>
	</sect1>
</chapter>
