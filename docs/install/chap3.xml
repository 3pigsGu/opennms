<?xml version="1.0" encoding="utf-8"?>
<chapter id="chap3" label="3">
<title>Chapter 3</title>
	<subtitle>Installation</subtitle>
	<sect1 id="chap3sect1" label="3.1">
		<title>Directory Structure</title>
		<para>
			When installed, OpenNMS installs to the following directories:
		</para>
		<table>
			<title>
				Installation Directories (Note that these directories
				are set in the installation documentation at build time.
				If you have built from source, they reflect your install
				settings.)
			</title>
			<tgroup cols="2">
				<thead>
					<row>
						<entry>Location</entry>
						<entry>Directory</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>OpenNMS Binaries</entry>
						<entry>@root.install@/bin</entry>
					</row>
					<row>
						<entry>OpenNMS Config Files</entry>
						<entry>@root.install@/etc/</entry>
					</row>
					<row>
						<entry>SQL Libraries</entry>
						<entry>@root.install.postgresql@</entry>
					</row>
					<row>
						<entry>Boot script</entry>
						<entry>@root.install.initdir@/opennms</entry>
					</row>
					<row>
						<entry>Database Store</entry>
						<entry>/var/lib/pgsql (and @root.install.share@ for SNMP performance data)</entry>
					</row>
				</tbody>
			</tgroup>
		</table>
	</sect1>
	<sect1 id="chap3sect2" label="3.2">
		<title>Installing OpenNMS from install.opennms.org</title>
		<para>
			To install or upgrade on a supported RPM platform, run, as root: 
			<programlisting>
	lynx -source http://install.opennms.org | sh
			</programlisting>
			This will always install the latest version.  If you want to
			specifically install the stable or unstable distribution, add
			<emphasis>/stable</emphasis> or <emphasis>/unstable</emphasis>
			to the end of the URL.
		</para>
	</sect1>
	<sect1 id="chap3sect3" label="3.3">
		<title>Installing OpenNMS from RPM</title>
		<para>
			The following is the proceedure for installing OpenNMS binaries from
			the RPM.
		</para>
		<orderedlist>
			<listitem>
				<para>
					Login as the "root" user. 
				</para>
			</listitem>
			<listitem>
				<para>
					Acquire the install RPM file(s) either from installation media (CD) or across the Internet. For internet 
					download, go to <ulink url="http://www.opennms.org/">www.OpenNMS.org</ulink>  Get the most current set of RPMs.
				</para>
			</listitem>
			<listitem>
				<para>
					install the RPMs 
					<programlisting>
	rpm -Uvh *.rpm
					</programlisting>
				</para>
			</listitem>
		</orderedlist>
	</sect1>
	<sect1 id="chap3sect4" label="3.4">
		<title>Installing OpenNMS from source</title>
		<para>
			Installation for OpenNMS on Linux systems is via 
			RPM packages or tar.gz build. Information on installation
			procedures for RPMs is included in the quickstart guide.
		</para>
		<para>The following is for building from the source tar bundle</para>
		<orderedlist>
			<listitem>
				<para>
					Login as the "root" user.
				</para>
			</listitem>
			<listitem>
				<para>
					Unpack source code
				</para>
			</listitem>
			<listitem>
				<para>
					Make sure the following environment variables are set to the correct locations 
					<programlisting>
	export OPENNMS_HOME=@root.install@
	export JAVA_HOME=/usr/java/j2sdk-1.4.0
	export TOMCAT_HOME=/var/tomcat4
					</programlisting>
				</para>
			</listitem>
			<listitem>
				<para>
					In order to let OpenNMS know where libraries and includes live, you will need
					to create an ~/.opennms-global.properties file.  It should look something like this.
					(Note that if PostgreSQL and RRDTool are installed in standard places, like /usr
					or /usr/local, these will be set automatically by the build.)
					<programlisting>
	compile.include=-I/usr/local/pgsql/include -I/usr/include -I. -I/usr/local/rrdtool-1.0.35/include
	compile.lib=-L/usr/local/pgsql/lib -L/usr/local/rrdtool-1.0.35/lib
					</programlisting>
				</para>
			</listitem>
			<listitem>
				<para>
					If you want to install to somewhere other than the dist/ directory
					under the OpenNMS source tree, copy any of the properties that you
					want to change from build.properties into your ~/.opennms-global.properties
					file and edit them.  Then, from the source directory, run the following
					command:
					<programlisting>
	./build.sh install
					</programlisting>
				</para>
			</listitem>
			<listitem>
				<para>
					You will also need to copy or symlink a number of files into the tomcat
					directories for some parts of the Web UI to run properly.
					<programlisting>
   ln -s $OPENNMS_HOME/lib/castor-*.jar \
         $OPENNMS_HOME/lib/jdbc2_0-stdext.jar \
         $OPENNMS_HOME/lib/log4j.jar \
         $OPENNMS_HOME/lib/opennms_*.jar \
         $TOMCAT_HOME/server/lib/
					</programlisting>
					(assuming you have installed the OpenNMS webapp into the
					$TOMCAT_HOME/webapps/opennms/ directory).
				</para>
			</listitem>
			<listitem>
				<para>
					run the install script for OpenNMS to create database
					<programlisting>
	$OPENNMS_HOME/bin/install.pl $OPENNMS_HOME/etc/create.sql
					</programlisting>
				</para>
			</listitem>
		</orderedlist>
	</sect1>
</chapter>
