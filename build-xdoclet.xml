<?xml version="1.0"?>
 
<!--=================================================================

   $Id$

==================================================================== -->
 
<project name="opennms" default="gensrc" basedir=".">
  <description>
Build file for OpenNMS' XDoclet generated Java files.
  </description>
	
<path id="xdoclet.class.path">
    <fileset dir="devlib/xdoclet-1.2.3">
		<include name="*.jar"/>
	</fileset>
	<fileset dir="lib">
		<include name="commons-logging.jar"/>
	</fileset>
</path>

<taskdef name="cleanimports" classname="com.tombrus.cleanImports.ant.CleanImports" classpath="${basedir}/devlib/cleanImports.jar" />
<taskdef name="hibernatedoclet" classname="xdoclet.modules.hibernate.HibernateDocletTask" classpathref="xdoclet.class.path" />
<taskdef name="webdoclet" classname="xdoclet.modules.web.WebDocletTask" classpathref="xdoclet.class.path" />
<taskdef name="xdoclet" classname="xdoclet.DocletTask" classpathref="xdoclet.class.path" />
<taskdef name="ejbdoclet" classname="xdoclet.modules.ejb.EjbDocletTask" classpathref="xdoclet.class.path" />
<taskdef name="jmxdoclet" classname="xdoclet.modules.jmx.JMXDocletTask" classpathref="xdoclet.class.path" />

 <!-- Generates Sablecc java files if necessary -->
 <target name="gensrc" depends="hibernate"/>
	
	<target name="prepare">
		<mkdir dir="work/hibernate"/>
	</target>
    
    <!-- =================================================================== -->
    <!-- Invoke XDoclet's hibernate                                          -->
    <!-- =================================================================== -->
    <target name="hibernate" depends="prepare" description="Generate mapping documents (run jar first)">

        <echo>+---------------------------------------------------+</echo>
        <echo>|                                                   |</echo>
        <echo>| R U N N I N G   H I B E R N A T E D O C L E T     |</echo>
        <echo>|                                                   |</echo>
        <echo>+---------------------------------------------------+</echo>

        <hibernatedoclet
            destdir="work/hibernate"
            mergedir="${samples.src.dir}"
            excludedtags="@version,@author,@todo,@see"
            addedtags="@xdoclet-generated at ${TODAY},@copyright The XDoclet Team,@author XDoclet,@version ${version}"
            force="${samples.xdoclet.force}"
            verbose="false">

            <fileset dir="src/services">
                <include name="org/opennms/netmgt/model/*.java"/>
            </fileset>

            <hibernate version="3.0"/>

            <jbossservice
                version="2.1.6"
                destdir="work/hibernate"
                jndiname="java:/hibernate/Samples"
                servicename="HibernateSamples"
                dialect="net.sf.hibernate.dialect.HSQLDialect"
                datasource="java:/DefaultDS"
                username="foo bar"
                password="blurge"
                autocreate="create-drop"
                defaultschema="blabla"
            />

        </hibernatedoclet>
    </target>


<target name="clean.imports" if="build.clean.imports">   
  <if>
  	<isfalse value="${sablecc.filter.sources.uptodate}" />
    <then>
     <echo>Cleaning imports for generated source...</echo>
     <cleanimports srcdir="${build.sablecc.source.dir}" />
    	</then>
 </if>
 </target>

</project>
