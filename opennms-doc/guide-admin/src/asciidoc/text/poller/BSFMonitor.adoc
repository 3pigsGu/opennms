
// Please keep first line an empty line to make sure, the ToC can be build correctly
=== BSFMonitor

This monitor runs a Bean Shell Framework (BSF) compatible script to determin the status of the service.


==== Monitor facts

[options="autowidth"]
|===
| Class Name     | `org.opennms.netmgt.poller.monitors.BSFMonitor`
| Remote Enabled | `false`
|===

==== Configuration and Usage

.Monitor specific parameters for the BSFMonitor
[options="header, autowidth"]
|===
| Parameter         | Description                                    | Required | Default value

| `file-name`       | Path to the script file.                              | required | `-`
| `lang-class`      | The BSF language class, like `groovy` or `beanshell`. | optional | `file-name extention is interpreted by default`

| `bsf-engine`      | The BSF Engine to run the script in, linke +
                      `bsh.util.BeanShellBSFEngine` or  +
                      `?groovy?`                                            | required | `-`
| `file-extensions` | comma seperated list                                  | optional | `-`
| `run-type`        | one of those `eval` or `exec`                         | optional | `eval`


// There is no retry of timeout in the BSFMonitor code....
// There are also no dedicated retry or timeout parameters handed over to the script, just the parameter map it self.
| `retry`          | text                                                   | optional | `-`
| `timeout`        | text                                                   | optional | `-`



|===


.Bean which can be used in the script
[options="header, autowidth"]
|===
| Variable     | Type                           | Description
| `map`        | Map<String, Object             | The _map_ contains all various parameters passed to the monitor +
                                                  from the service definition it the _poller-configuration.xml_ file.
| `ip_addr`    | String                         | The IP address that is currently being polled.
| `node_id`    | int                            | The Node ID of the node the _ip_addr_ belongs to.
| `node_label` | String                         | The Node Label of the node the _ip_addr_ and service belongs to.
| `svc_name`   | String                         | The name of the service that is being polled.
| `bsf_monitor`| BSFMonitor                     | The instance of the _BSFMonitor_ object calling the script. +
                                                  Useful for logging via its +
                                                  log(String sev, String fmt, Object... args) method.
| `result`     | HashMap<String, String>        | The script is ecpected to put it results into this object. +
                                                  The status indication sould be set into the entry with key _status_. +
                                                  If the status is not _OK_, a key _reason_ shoud contain a +
                                                  description of the problem.
| `times`      | LinkedHashMap<String, Number>  | The script is expected to put one or more response times into this object.
|===

==== Examples
Some example configuration how to configure the monitor in the `poller-configuration.xml`
[source, xml]
----
<parameter key="args" value="-i {variable3} -t ${variable2}"/>
<parameter key="args" value="http://${variable1}/${variable2}/static"/>
----

.This section is optional and give some specific hints
==== SystemExecuteMonitor vs GpMonitor

The SystemExecuteMonitor is the successor of the GpMonitor. The main differences are:

* Variable replacement for the parameter args
* There are no fixed arguments handed to the system-call
* The _SystemExecuteMonitor_ supports _RemotePoller_ deployment

To migrate services from the _GpMonitor_ to the _SystemExecuteMonitor_ it is required to alter the parameter args.
To match the arguments called `hoption` for the `hostAddress` and `toption` for the `timeoutInSeconds`.
The args string that matches the _GpMonitor_ call looks like this:

[source, xml]
----
<parameter key="my parameter 2" value="--hostname ${variable1} --timeout ${variable2}" />
----

To migrate the GpMonitor parameters `hoption` and `toption` just replace the `--hostname` and `--timeout` directly in the args key.
